<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>照片</title>
<script src="../../js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="../../js/pic.js"></script>
    <style>
#pictures {position:absolute;height:100%; width:100%;overflow:hidden;}
#pictures img { position:absolute;text-align: center;top: 10px;right: 0px;bottom: 10px;left: 0px;margin:auto; border-radius:5px; box-shadow:rgba(51,51,51,0.3) 0px 0px 5px 1px; height:600px;}
#prev { margin-top: auto; text-align: center; position:absolute;left:0px;top:50%; margin-top:-100px; width:60px; height:200px; background-color:rgba(255,255,255,0.2);font-size:36px; line-height:180px; border-radius:0px 5px 5px 0px; }
#next { margin-top: auto; text-align: center; position:absolute;right:0px;top:50%; margin-top:-100px; width:60px; height:200px; background-color:rgba(255,255,255,0.2);font-size:36px; line-height:180px; border-radius:5px 0px 0px 5px;}
a{text-decoration:none;}
#prev:hover{background-color:#FFF;}
#next:hover{background-color:#FFF;}
#phopan{transform:translateY(-23px);
		-webkit-transform:translateY(-23px);}
#phopan:hover{transform:translateY(0px);
-webkit-transform:translateY(0px);}
.menupa{ background-color:#999; cursor:pointer;}
.menupa:hover,.menupa:active{ background-color:#CCC; }
	</style>
</head>

<body onLoad="photolist();" style="margin:0px;padding:0px; background-image:url(../../pageFile/img/back.jpg); background-repeat:repeat; background-size:cover; background-attachment:fixed;">
   
    <div id="phopan" style="position:fixed;top:0px;height:30px;width:360px;margin-left:-180px; left:50%;padding:0px;z-index:7777; background-color:rgba(255,255,255,0.7); border-radius:0px 0px 5px 5px; line-height:30px; box-shadow: rgba(0,0,0,0.5) 1px 1px 10px 1px;">
       <span style="float:left; margin-left:40px;">相册</span>
       <a href="#" onClick="upfile()"  style="margin-left: 30px;">图片管理</a>
       <a href="#" onClick="viewoth()" style="margin-left: 25px;">查看共享</a>
       <a href="#" onClick="parent.reback('page-3');" style="float:right;margin-right:40px;">返回</a>
    </div>
   
      
   <iframe src="" id="pframe" name="pframe" frameborder="0" align="middle"  style="display:none;"></iframe>


      
<div id="uppanel" style="display:none;background-color:rgba(51,51,51,0.8); position:fixed; top:0px; left:0px; z-index:9999; width:100%; height:100%;">

     <div id="minipan" style="position:absolute;height:400px;width:500px;background-color:rgba(254,254,254,0.7);border-radius:5px;margin-top:-200px;top:50%;left:50%;margin-left:-250px; vertical-align:middle; box-shadow: rgba(0,0,0,0.7) 1px 1px 15px 3px;" >
     <div class="menupa" style="height:54px; text-align:center; width:120px; float:left; line-height:54px; border-radius:5px 0px 0px 5px;margin-left: 50px;">上传新图片</div>
     <div class="menupa" style="height:54px; text-align:center; width:120px; float:left; line-height:54px; border-radius:0px 5px 5px 0px;" onClick="mylist()">管理我的图片</div>
    <a style="float:right; margin-right:15px; margin-top:5px; cursor:pointer;background-image:url(../../pageFile/img/close.png); background-position:left center; background-repeat:no-repeat; background-size:24px 24px; height:24px; width:24px;" onClick="clospane();photolist();"></a>
    
      <form action="photolist.php" target="pframe" method="post" enctype="multipart/form-data" name="upl" id="upl" onSubmit="subing()">
    <div style="margin: 70px 50px 10px 50px;">
        <div style="float:left; height:32px;">
        <input type="text" disabled style="background-color:#FFF;width:403px;border-radius:5px; height:32px;" id="filen">
        <input type="file" style="background-color:#FFF;width:400px;border-radius:5px; height:32px; display:none;"  id="filec"  name="filec" onChange="getfc()">
        </div>
    </div>
    
    <div align="center" style="line-height:32px;background-color:rgba(254,254,254,0.5); height:32px; width:410px; margin:20px 50px; position:absolute;border-radius:5px;cursor:pointer; top:95px;" id="fc" onClick="cf()">
    请选择上传文件
    </div>
    
    <div style=" height:145px; width:405px; top:150px; position:absolute; margin:10px 50px;">
    <textarea id="altr" name="altr" cols="" rows="" style="width:100%; height:100%;" placeholder="在此添加图片的故事背景" ></textarea></div>
    
    <div style="margin:50px; position:absolute; bottom:0px;">
        <div style="float:left;">
        	<input  type="radio" name="access" value="1"  id="access">共享本图
        </div>
        <div style="float:right; position:absolute;left:305px; width:120px;">
        	<input type="reset" value="重置" onClick="resetd()">
            <input type="submit" value="上传">
        </div>
    </div>
</form>
  
   </div>
</div>
     
    <div id="pictures">
            
    </div>
          
         
          <div id="prev" style="">
            <a href="#previous" style="position: absolute;width:60px; height:200px; margin-left:-33px;">«</a>
          </div>
          
          <div id="next" style="">
            <a href="#next" style="position: absolute;width:60px; height:200px; margin-right:-33px; left: -1px;">»</a>
          </div>
      
<div  id="wat" style=" position:absolute; width:350px; height:60px; left:50%; top:50%; margin-left:-175px; margin-top:-30px; background-color:rgba(200,213,206,0.7);z-index:99999; border-radius:5px; box-shadow:2px 2px 11px #999999; display:none; background-image:url(../../pageFile/personal/load.gif); background-repeat:no-repeat; background-position:40px center; text-align:center; line-height:60px;">
正在上传，请稍后</div>

<div id="ppan" style="display:none; position:absolute; width: 800px; height:600px; top:50%; left:50%; margin:-300px  0px 0px -400px; background-color:#fff; z-index:9999; border-radius:5px; overflow:auto;">
	<span  style="position:fixed;height:30px;width:800px;margin-left:-400px;padding:0px;z-index:7777; background-color:rgba(255,255,255,0.7); border-radius:5px; line-height:30px; box-shadow: rgba(0,0,0,0.5) 1px 1px 10px 1px;left:50%;">
		<a style="float:right; margin-right:15px; margin-top:5px; cursor:pointer;background-image:url(../../pageFile/img/close.png); background-position:left center; background-repeat:no-repeat; background-size:24px 24px; height:24px; width:24px;" onClick="clospane();photolist();"></a>
    	</span>
</div>
<script>
function mylist(){
	$("#minipan").css("display","none");
	$("#ppan").css("display","block");
	
}
function dleph(did){
	var aid=$("#ppan div img").eq(did).attr("did");
	$.ajax({
			type:"POST",
			data:{'type':"del",'phid':aid},
			dataType:"json",
			url:"photolist2.php",
			success: function(data){
				alert(data[1]);
				if(data[0]=="success"){
					$("#ppan div").eq(did).css("display","none");
					}
				},
			error:function(){
				alert("删除失败");
				}
	});
	}
function viewoth()
	{
		$.ajax({
			type:"POST",
			data:{'type':"shar"},
			dataType:"json",
			url:"photolist2.php",
			success: function(data)
			{
				var str="";
				var pstr="";
				var lisid=0;
				$.each(data,function(ind){
					str+='<img src="../../userdata/upload/'+
					data[ind].pic+'"  alt="'+data[ind].alt+'" title="来自'+data[ind].nick+'的共享\n描述:'+data[ind].alt+'" style="top: 0px;" class="shrinkToFit ">';
					});
				$("#pictures").text("").append(str);
			},
			error:function(){
				alert("错误！");
				},
			complete: function()
			{
				z=0;
				  $('#pictures img').each(function() {
    					 z++; 
   						 $(this).css('z-index', z); 
  						});
			}
		});
	}
function photolist(){
		$.ajax({
			type:"POST",
			data:{'type':"list"},
			dataType:"json",
			url:"photolist2.php",
			success: function(data)
			{
				var str="";
				var pstr="";
				var lisid=0;
				$.each(data,function(ind){
					str+='<img src="../../userdata/upload/'+
					data[ind].pic+'" alt="'+data[ind].alt+'" style="top: 0px;" class="shrinkToFit " title="描述:'+data[ind].alt+'">';
					pstr+='<div style="float:left;margin:30px;"><img src="../../userdata/upload/'+data[ind].pic+'" alt="'+data[ind].alt+'" style="top: 0px;max-height:150px;max-width:200px; min-height:150px;min-width:200px;" class="shrinkToFit" did="'+data[ind].pic+'" height:200px;width:200px;><br><input name="deleph" style="margin-left:40%;" type="button" value="删除" onClick="'+
					'dleph('+lisid+')"></div>';
					lisid++;
					});
				$("#pictures").text("").append(str);
				$("#ppan div").remove();
				$("#ppan").append(pstr);
			},
			error:function(){
				alert("错误！");
				},
			complete: function()
			{
				z=0;
				  $('#pictures img').each(function() {
    					 z++; 
   						 $(this).css('z-index', z); 
  						});
			}
			});
	}
var z = 0;





function clospane(){
	$("#uppanel").css("display","none");
	$("#ppan").css("display","none");
	}
function upfile(){
	$("#uppanel").height(window.innerHeight).width(window.innerWidth).css("display","block");
	$("#upl").css("display","block");
	$("#minipan").css("display","block");
	}
function difup(){
	$("#minipan").css("display","block");
	$("#wat").css("display","none");
	}
function cf()
{
	$("#filec").trigger("click");
}
function getfc(){
	
	$("#filen").attr("value",$("#filec").attr("value"));
	$("#fc").text("单击上传按钮上传选中文件");
	}
function resetd()
{
	document.getElementById("upl").reset();
}
var wbg='url(../../pageFile/personal/load.gif)';
var ins;
var wat=document.getElementById("wat");
function subing(){
		wat.style.display="block";
		wat.style.backgroundImage=wbg;
		wat.innerHTML="正在上传，请稍后";
		//document.getElementById("upl").style.display="none";
		$("#minipan").css("display","none");
		ins=window.setInterval(upresult,1000);
		
	}
function upresult(){
	var pf=document.getElementById("pframe").contentWindow.document||document.getElementById("pframe").contentDocument;
	if(pf.getElementById("inf"))
		{
			if(pf.getElementById("inf").getAttribute("name")=="success")
			{
				wat.style.backgroundImage="";
				wat.innerHTML=pf.getElementById("inf").innerHTML+"上传成功";
				pf.innerHTML="";
				resetd();
				clearInterval(ins);
				setTimeout(difup,600);
			}
			else
			{
				wat.style.backgroundImage="";
				wat.innerHTML="因为"+pf.getElementById("inf").innerHTML+",导致上传失败";
				pf.innerHTML="";
				resetd();
				clearInterval(ins);
				setTimeout(difup,1000);
			}
		}
	
	}


</script>
</body>
</html>
